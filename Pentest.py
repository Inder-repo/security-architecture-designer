import streamlit as st
import subprocess
import json

def run_ai_pentest(target_url):
    # Example: Call a local or cloud AI pentest agent
    # This could be a REST API, a CLI tool, or a cloud service
    # Here, we simulate with a local script or tool (replace with real integration)
    try:
        # Example with a local Python script or CLI tool
        result = subprocess.run(
            ["python", "ai_pentest_agent.py", "--target", target_url],
            capture_output=True, text=True, timeout=600
        )
        if result.returncode == 0:
            findings = json.loads(result.stdout)
            return findings
        else:
            st.error("Penetration test failed: " + result.stderr)
            return None
    except Exception as e:
        st.error(f"Error running AI pentest: {e}")
        return None

# In your Streamlit app after controls are generated:
st.header("Automated AI Penetration Testing")
target_url = st.text_input("Enter the application URL or IP to test")

if st.button("Run Automated Pen Test"):
    with st.spinner("Running AI-powered penetration test..."):
        findings = run_ai_pentest(target_url)
        if findings:
            st.success("Penetration test completed.")
            for vuln in findings.get("vulnerabilities", []):
                st.error(f"Vulnerability: {vuln['name']}")
                st.write(f"Description: {vuln['description']}")
                st.write(f"Severity: {vuln['severity']}")
                st.write(f"Remediation: {vuln['remediation']}")
